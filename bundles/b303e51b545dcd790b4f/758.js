"use strict";(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[758],{"./node_modules/matrix-react-sdk/src/async-components/views/dialogs/security/CreateKeyBackupDialog.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>h});var a=s("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=s("./node_modules/react/index.js"),r=s("./node_modules/matrix-js-sdk/src/logger.ts"),i=s("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),c=s("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),o=s("./node_modules/matrix-react-sdk/src/SecurityManager.ts"),l=s("./node_modules/matrix-react-sdk/src/components/views/elements/Spinner.tsx"),u=s("./node_modules/matrix-react-sdk/src/components/views/dialogs/BaseDialog.tsx"),d=s("./node_modules/matrix-react-sdk/src/components/views/elements/DialogButtons.tsx"),p=function(e){return e.BackingUp="backing_up",e.Done="done",e}(p||{});class h extends n.PureComponent{constructor(e){super(e),(0,a.Z)(this,"createBackup",(async()=>{let e;this.setState({error:void 0});const t=i.p.safeGet();try{await(0,o.zL)((async()=>{e=await t.prepareKeyBackupVersion(null,{secureSecretStorage:!0}),e=await t.createKeyBackupVersion(e)})),await t.scheduleAllGroupSessionsForBackup(),this.setState({phase:p.Done})}catch(a){var s;r.k.error("Error creating key backup",a),null!==(s=e)&&void 0!==s&&s.version&&t.deleteKeyBackupVersion(e.version),this.setState({error:!0})}})),(0,a.Z)(this,"onCancel",(()=>{this.props.onFinished(!1)})),(0,a.Z)(this,"onDone",(()=>{this.props.onFinished(!0)})),this.state={phase:p.BackingUp,passPhrase:"",passPhraseValid:!1,passPhraseConfirm:"",copied:!1,downloaded:!1}}componentDidMount(){this.createBackup()}renderBusyPhase(){return n.createElement("div",null,n.createElement(l.Z,null))}renderPhaseDone(){return n.createElement("div",null,n.createElement("p",null,(0,c._t)("settings|key_backup|backup_in_progress")),n.createElement(d.Z,{primaryButton:(0,c._t)("action|ok"),onPrimaryButtonClick:this.onDone,hasCancel:!1}))}titleForPhase(e){switch(e){case p.BackingUp:return(0,c._t)("settings|key_backup|backup_starting");case p.Done:return(0,c._t)("settings|key_backup|backup_success");default:return(0,c._t)("settings|key_backup|create_title")}}render(){let e;if(this.state.error)e=n.createElement("div",null,n.createElement("p",null,(0,c._t)("settings|key_backup|cannot_create_backup")),n.createElement(d.Z,{primaryButton:(0,c._t)("action|retry"),onPrimaryButtonClick:this.createBackup,hasCancel:!0,onCancel:this.onCancel}));else switch(this.state.phase){case p.BackingUp:e=this.renderBusyPhase();break;case p.Done:e=this.renderPhaseDone()}return n.createElement(u.Z,{className:"mx_CreateKeyBackupDialog",onFinished:this.props.onFinished,title:this.titleForPhase(this.state.phase),hasCancel:[p.Done].includes(this.state.phase)},n.createElement("div",null,e))}}}}]);
//# sourceMappingURL=758.js.map